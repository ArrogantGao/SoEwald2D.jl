export soerfc, SoePara, SoExPara, exp_mul_erfc

struct SoePara{T} 
    sw::Vector{Tuple{T, T}}
end

struct SoExPara{T} 
    sw::Vector{Tuple{T, T}}
end

# the default 18 terms approach
SoePara() = SoePara{ComplexF64}([
    (4.56160429581067 - 8.10664614462486im, 1.7841998933545696e-7 + 7.343003636293712e-7im),
    (4.56160429581067 + 8.10664614462486im, 1.7841998935002611e-7 - 7.343003636293118e-7im),
    (4.67614751620509 - 6.66817205403247im, -9.556499453539262e-5 - 0.00015001811262319774im),
    (4.67614751620509 + 6.66817205403247im, -9.556499453567014e-5 + 0.00015001811262314695im),
    (4.75706771210077 - 5.46277771275372im, 0.007705869731927555 + 0.002956305642083839im),
    (4.75706771210077 + 5.46277771275372im, 0.007705869731931252 - 0.0029563056420808262im),
    (4.81739468471801 - 4.37139574323745im, -0.13131561540899633 + 0.0581715387810661im),
    (4.81739468471801 + 4.37139574323745im, -0.13131561540901635 - 0.0581715387810941im),
    (4.86201933938979 - 3.34750236244862im, 0.3353050941709935 - 1.1598168978326757im),
    (4.86201933938979 + 3.34750236244862im, 0.3353050941710323 + 1.15981689783286im),
    (4.89345823682377 - 2.3658861273834im, 3.3749677449815447 + 4.418684212942269im),
    (4.89345823682377 + 2.3658861273834im, 3.3749677449817934 - 4.41868421294285im),
    (4.91338156910332 - 1.41021110952036im, -14.965174561023547 + 0.8807329873608107im),
    (4.91338156910332 + 1.41021110952036im, -14.965174561024503 - 0.8807329873602142im),
    (4.92300187934591 - 0.468589313154398im, 11.878606854122312 - 21.3765363724229im),
    (4.92300187934591 + 0.468589313154398im, 11.878606854123603 + 21.376536372422756im),
    (0.0334524767879181 - 0.0245907245253121im, 4.394108031340191e-15 + 6.7735884437017495e-15im),
    (0.0334524767879181 + 0.0245907245253121im, 4.394104404590236e-15 - 6.773593136580561e-15im)
])

function soerfc(x::T1, sw::SoePara{T2}) where{T1<:Real, T2}

    x = T2(x)

    sum = zero(T2)
    for (si, wi) in sw.sw
        sum += wi * exp( - si * x)
    end
    return T1(real(sum))
end

function soexp(x::T1, sw::SoExPara{ComplexF64}) where{T1<:Real}
    x = T2(x)

    sum = zero(T2)
    for (si, wi) in sw.sw
        sum += wi * si * exp( - si * x)
    end
    return T1(real(sum))
end

SoExPara() = SoExPara{ComplexF64}(
    [(4.56160429581067 - 8.10664614462486im, 5.99673832958228e-6 + 1.6866670619023293e-6im),
    (4.56160429581067 + 8.10664614462486im, 5.99673832964075e-6 - 1.6866670617974198e-6im),
    (4.67614751620509 - 6.66817205403247im, -0.00128256763349392 - 5.695159986823037e-5im),
    (4.67614751620509 + 6.66817205403247im, -0.0012825676334947697 + 5.6951599866379874e-5im),
    (4.75706771210077 - 5.46277771275372im, 0.046798971665701586 - 0.02484280827698599im),
    (4.75706771210077 + 5.46277771275372im, 0.04679897166570259 + 0.024842808277016595im),
    (4.81739468471801 - 4.37139574323745im, -0.3352670287775939 + 0.7570751116791558im),
    (4.81739468471801 + 4.37139574323745im, -0.33526702877757086 - 0.7570751116793528im),
    (4.86201933938979 - 3.34750236244862im, -1.9959868267018301 - 5.9922116425601im),
    (4.86201933938979 + 3.34750236244862im, -1.9959868267022096 + 5.992211642561009im),
    (4.89345823682377 - 2.3658861273834im, 23.900979544670903 + 12.086236335461203im),
    (4.89345823682377 + 2.3658861273834im, 23.900979544673195 - 12.086236335463198im),
    (4.91338156910332 - 1.41021110952036im, -64.06321166786559 + 22.5380203666186im),
    (4.91338156910332 + 1.41021110952036im, -64.06321166787049 - 22.538020366617197im),
    (4.92300187934591 - 0.468589313154398im, 42.94796357790219 - 98.1965284307393im),
    (4.92300187934591 + 0.468589313154398im, 42.9479635779079 + 98.1965284307392im),
    (0.0334524767879181 - 0.0245907245253121im, 2.7788641755593297e-16 + 1.0505246242344095e-16im),
    (0.0334524767879181 + 0.0245907245253121im, 2.7788641230727297e-16 - 1.0505268058842997e-16im)]
)

# this formula is used to count the formula exp(kz) erfc(k/2α + αz)
function exp_mul_erfc(z::T, α::T, k::T, soexpara::SoExPara{ComplexF64}) where{T <: Number}
    sum = zero(ComplexF64)
    for (s, w) in soexpara.sw
        sum += w / (s * α + k) * exp(-s * α * z)
    end
    return exp(- k^2 / (4 * α^2)) * sum * 2α / sqrt(π)
end